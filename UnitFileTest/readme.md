# SystemD Testing

## Setup

```bash
# Copy the files to the correct locations
sudo cp ./log_test.sh /usr/local/bin/log_test.sh
sudo cp ./log_test.service ./log_test.timer /etc/systemd/system/

# Reload the daemon, enable the timer, and start the timer
systemctl daemon-reload
systemctl enable log_test.timer
systemctl start log_test.timer
```

## Verify Setup

```bash
# Check the status of the timer
systemctl list-timers --all

# Output
NEXT                          LEFT LAST                              PASSED UNIT                         ACTIVATES                     
Tue 2024-12-10 07:10:00 GMT    18s -                                      - log_test.timer               log_test.service
```

```bash
# Check the status of the service
systemctl status log_test.service

# Output
# This example shows the service is failed due to the script not being executable
× log_test.service - Log Time Service
     Loaded: loaded (/etc/systemd/system/log_test.service; static)
    Drop-In: /usr/lib/systemd/system/service.d
             └─10-timeout-abort.conf, 50-keep-warm.conf
     Active: failed (Result: exit-code) since Tue 2024-12-10 07:10:01 GMT; 50s ago
   Duration: 29ms
 Invocation: 00ecb6901c344a22bab1fa240f3b1501
TriggeredBy: ● log_test.timer
    Process: 35924 ExecStart=/usr/local/bin/log_test.sh (code=exited, status=203/EXEC)
```

```bash
# Check the status of the timer
systemctl status log_test.timer

# Output
# This example shows the timer is active and waiting for the next trigger
● log_test.timer - Run Log Time Service every minute
     Loaded: loaded (/etc/systemd/system/log_test.timer; enabled; preset: disabled)
     Active: active (waiting) since Tue 2024-12-10 07:09:27 GMT; 1min 13s ago
 Invocation: d26d8760e0774dbb83a7003d42d6ed3c
    Trigger: Tue 2024-12-10 07:11:00 GMT; 19s left
   Triggers: ● log_test.service

Dec 10 07:09:27 GW-T480 systemd[1]: Started log_test.timer - Run Log Time Service every minute.
```

## Reading Logs

```bash
# Check the logs of the service
journalctl -u log_test.service

# Example Output
# Example shows one failed execution and one successful execution
Dec 10 07:12:03 GW-T480 systemd[1]: Started log_test.service - Log Time Service.
Dec 10 07:12:03 GW-T480 (_test.sh)[37457]: log_test.service: Unable to locate executable '/usr/local/bin/log_test.sh': Permission denied
Dec 10 07:12:03 GW-T480 (_test.sh)[37457]: log_test.service: Failed at step EXEC spawning /usr/local/bin/log_test.sh: Permission denied
Dec 10 07:12:03 GW-T480 systemd[1]: log_test.service: Main process exited, code=exited, status=203/EXEC
Dec 10 07:12:03 GW-T480 systemd[1]: log_test.service: Failed with result 'exit-code'.
Dec 10 07:13:29 GW-T480 systemd[1]: Started log_test.service - Log Time Service.
Dec 10 07:13:29 GW-T480 systemd[1]: log_test.service: Deactivated successfully.
```

```bash
# Check the logs of the timer
journalctl -u log_test.timer
```

```bash
# Check the logs generated by the script
journalctl -t log_time_script # The name given to the logger in the script

# Example Output
> journalctl -t log_time_script                      
Dec 10 07:13:29 GW-T480 log_time_script[38473]: 2024-12-10 07:13:29 - Script executed
Dec 10 07:14:04 GW-T480 log_time_script[38959]: 2024-12-10 07:14:04 - Script executed
Dec 10 07:15:00 GW-T480 log_time_script[39600]: 2024-12-10 07:15:00 - Script executed
```

## Extras

### Export Logs to File

```bash
#!/bin/bash

# File: /usr/local/bin/export_logs.sh
OUTPUT_FILE="/var/log/log_time_script_plain.log"
journalctl -t log_time_script > $OUTPUT_FILE
```

Make the script executable

```bash
sudo chmod +x /usr/local/bin/export_logs.sh
```

Create a service to run the script

```bash
# File: /etc/systemd/system/export_logs.service
[Unit]
Description=Export log_time_script logs to plain text

[Service]
ExecStart=/usr/local/bin/export_logs.sh
```

Create a timer to run the service

```bash
# File: /etc/systemd/system/export_logs.timer
[Unit]
Description=Run Export Logs Service daily

[Timer]
OnCalendar=daily
Persistent=true

[Install]
WantedBy=timers.target
```

Start and enable the timer

```bash
sudo systemctl daemon-reload
sudo systemctl enable export_logs.timer
sudo systemctl start export_logs.timer
```

Inspect the logs

```bash
less /var/log/log_time_script_plain.log
```